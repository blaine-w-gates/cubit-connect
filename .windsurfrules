# Cubit Connect Rules

## 1. Browser Reality Checks (The "Antigravity" Protocols)

* **ASYNC VIDEO:** Never loop through timestamps synchronously. You MUST use a recursive function/queue that waits for `video.onseeked`.
* **MEMORY SAFETY:** - Always downscale canvas images (max 640px).
    - Use Virtualization for long lists of images.
* **JSON SAFETY:** Always wrap `JSON.parse` in a try/catch. Strip "```json" fences before parsing.
* **AI SAFETY:** Handle `finishReason: SAFETY` gracefully.
* **STRICT MODE:** Use `useRef` lock or Zustand machine to prevent double-execution of AI calls.
* **RATE LIMITS:** Respect a robust delay between AI calls (default 2s+).
* **HYDRATION:** Always keep `suppressHydrationWarning` on `<html>` and `<body>` to prevent "Jetski" extension crashes.

## 2. Architecture Constraints

* **NO SERVERS:** GitHub Pages only.
* **NO FFMPEG:** Use Canvas API.
* **Input Validation:** Test API Key before saving. Use Loose Regex for VTT.
